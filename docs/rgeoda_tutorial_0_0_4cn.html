<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>rgeoda v0.0.4教程</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">rgeoda v0.0.4教程</h1>



<p>rgeoda是用于空间数据分析的R库。它是libgeoda C ++库的R包装，该库基于GeoDa软件构建。本教程中使用的版本为0.0.4。</p>
<div id="rgeoda" class="section level2">
<h2>1. 安装rgeoda</h2>
<p>像GeoDa桌面软件一样，rgeoda可用于不同的平台，包括：Mac，Linux和Windows。</p>
<div id="mac-osxlinux" class="section level3">
<h3>Mac OSX和Linux</h3>
<p>在R控制台中，使用install.packages（）函数从源pacakge安装rgeoda，package的地址为: <a href="https://github.com/lixun910/rgeoda/archive/0.0.4.tar.gz" class="uri">https://github.com/lixun910/rgeoda/archive/0.0.4.tar.gz</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;https://github.com/lixun910/rgeoda/archive/0.0.4.tar.gz&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># or the development version</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># devtools::install_github(&quot;lixun910/rgeoda&quot;)</span></a></code></pre></div>
</div>
<div id="windows" class="section level3">
<h3>Windows</h3>
<p>在R控制台中，使用install.packages（）函数从源pacakge安装rgeoda，package的地址为: <a href="https://github.com/lixun910/rgeoda/releases/download/0.0.4/rgeoda_0.0.4.zip" class="uri">https://github.com/lixun910/rgeoda/releases/download/0.0.4/rgeoda_0.0.4.zip</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;https://github.com/lixun910/rgeoda/releases/download/0.0.4/rgeoda_0.0.4.zip&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co"># or the development version</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># devtools::install_github(&quot;lixun910/rgeoda&quot;)</span></a></code></pre></div>
<p>不建议在Windows源代码包中安装rgeoda。如果您知道如何在Windows上使用<a href="https://www.r-project.org/nosvn/pandoc/devtools.html">R devtools</a>，则可以尝试。</p>
</div>
<div id="rrgeoda" class="section level3">
<h3>在R中加载rgeoda库</h3>
<p>如果所有内容均安装正确，则应该可以运行下面的代码加载rgeoda：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(rgeoda)</a></code></pre></div>
</div>
</div>
<div class="section level2">
<h2>2. 读取空间数据</h2>
<p>rgeoda可以直接读取的数据格式包括: ESRI Shapefile, MapInfo File, CSV, GML, GPX, KML, GeoJSON, TopoJSON, OpenFileGDB, GFT Google Fusion Tables, CouchDB</p>
<p>注意：在本教程中，我们仅使用rgeoda v0.0.4测试了加载ESRI shapefile。如果在加载空间数据时遇到任何问题，请提交问题报告到rgeoda的 <a href="https://github.com/lixun910/rgeoda/issues">网站</a>。</p>
<p>例如，要加载软件包自带的ESRI Shapefile Guerry.shp：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">guerry_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Guerry.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;rgeoda&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">guerry &lt;-<span class="st"> </span><span class="kw">geoda_open</span>(guerry_path)</a></code></pre></div>
<p><code>geoda_open</code> 函数返回一个geoda对象，该对象带有一个table属性，提供了一个R的dataframe数据结构，可用于访问读入数据的元数据，字段和列。 R 用户可以调用as.data.frame()方法获取个该dataframe数据:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">guerry_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(guerry)</a></code></pre></div>
<div id="attributes-of-geoda_df-dataframe" class="section level4">
<h4>2.1 Attributes of <code>geoda_df</code> dataframe</h4>
<p>R用户可以使用通用的dataframe函数来访问数据的基本信息包括：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">number of columns:&quot;</span>, <span class="kw">ncol</span>(guerry_df))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; number of columns: 29</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">number of observations:&quot;</span>, <span class="kw">nrow</span>(guerry_df))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; number of observations: 85</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">field names:&quot;</span>, <span class="kw">names</span>(guerry_df))</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; field names: CODE_DE COUNT AVE_ID_ dept Region Dprtmnt Crm_prs Crm_prp Litercy Donatns Infants Suicids MainCty Wealth Commerc Clergy Crm_prn Infntcd Dntn_cl Lottery Desertn Instrct Prsttts Distanc Area Pop1831 TopCrm TopLit TopWealth</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">field types:&quot;</span>, <span class="kw">str</span>(guerry_df))</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 'data.frame':    85 obs. of  29 variables:</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;  $ CODE_DE  : chr  &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; ...</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;  $ COUNT    : num  1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;  $ AVE_ID_  : num  49 812 1418 1603 1802 ...</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;  $ dept     : int  1 2 3 4 5 7 8 9 10 11 ...</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;  $ Region   : chr  &quot;E&quot; &quot;N&quot; &quot;C&quot; &quot;E&quot; ...</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  $ Dprtmnt  : chr  &quot;Ain&quot; &quot;Aisne&quot; &quot;Allier&quot; &quot;Basses-Alpes&quot; ...</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  $ Crm_prs  : int  28870 26226 26747 12935 17488 9474 35203 6173 19602 15647 ...</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  $ Crm_prp  : int  15890 5521 7925 7289 8174 10263 8847 9597 4086 10431 ...</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt;  $ Litercy  : int  37 51 13 46 69 27 67 18 59 34 ...</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt;  $ Donatns  : int  5098 8901 10973 2733 6962 3188 6400 3542 3608 2582 ...</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt;  $ Infants  : int  33120 14572 17044 23018 23076 42117 16106 22916 18642 20225 ...</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt;  $ Suicids  : int  35039 12831 114121 14238 16171 52547 26198 123625 10989 66498 ...</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="co">#&gt;  $ MainCty  : int  2 2 2 1 1 1 2 1 2 2 ...</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#&gt;  $ Wealth   : int  73 22 61 76 83 84 33 72 14 17 ...</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt;  $ Commerc  : int  58 10 66 49 65 1 4 60 3 35 ...</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co">#&gt;  $ Clergy   : int  11 82 68 5 10 28 50 39 42 15 ...</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="co">#&gt;  $ Crm_prn  : int  71 4 46 70 22 76 53 74 77 80 ...</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co">#&gt;  $ Infntcd  : int  60 82 42 12 23 47 85 28 54 35 ...</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="co">#&gt;  $ Dntn_cl  : int  69 36 76 37 64 67 49 63 9 27 ...</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt;  $ Lottery  : int  41 38 66 80 79 70 31 75 28 50 ...</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="co">#&gt;  $ Desertn  : int  55 82 16 32 35 19 62 22 86 63 ...</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt;  $ Instrct  : int  46 24 85 29 7 62 9 77 15 48 ...</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="co">#&gt;  $ Prsttts  : int  13 327 34 2 1 1 83 3 207 1 ...</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="co">#&gt;  $ Distanc  : num  218.4 65.9 161.9 351.4 320.3 ...</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co">#&gt;  $ Area     : int  5762 7369 7340 6925 5549 5529 5229 4890 6004 6139 ...</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="co">#&gt;  $ Pop1831  : num  346 513 298 156 129 ...</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">#&gt;  $ TopCrm   : num  1 1 1 0 0 0 1 0 0 0 ...</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">#&gt;  $ TopLit   : num  0 1 0 1 1 0 1 0 1 0 ...</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">#&gt;  $ TopWealth: num  1 0 1 1 1 1 0 1 0 0 ...</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42"><span class="co">#&gt; field types:</span></a></code></pre></div>
</div>
<div id="access-table-data" class="section level3">
<h3>2.2 Access Table Data</h3>
<p>R用户可以使用通用的dataframe函数来访问数据的内容：</p>
<p>得到第一列的数据</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">guerry_df[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;  [1] &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; &quot;05&quot; &quot;07&quot; &quot;08&quot; &quot;09&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; [15] &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;30&quot;</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [29] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;40&quot; &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; [43] &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;50&quot; &quot;51&quot; &quot;52&quot; &quot;53&quot; &quot;54&quot; &quot;55&quot; &quot;56&quot; &quot;57&quot; &quot;58&quot;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [57] &quot;59&quot; &quot;60&quot; &quot;61&quot; &quot;62&quot; &quot;63&quot; &quot;64&quot; &quot;65&quot; &quot;66&quot; &quot;67&quot; &quot;68&quot; &quot;69&quot; &quot;70&quot; &quot;71&quot; &quot;72&quot;</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [71] &quot;75&quot; &quot;76&quot; &quot;77&quot; &quot;78&quot; &quot;79&quot; &quot;80&quot; &quot;81&quot; &quot;82&quot; &quot;83&quot; &quot;84&quot; &quot;85&quot; &quot;86&quot; &quot;87&quot; &quot;88&quot;</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; [85] &quot;89&quot;</span></a></code></pre></div>
<p>得到第一行的数据</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">guerry_df[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;    CODE_DE COUNT AVE_ID_ dept Region Dprtmnt Crm_prs Crm_prp Litercy</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; NA      01     1      49    1      E     Ain   28870   15890      37</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;    Donatns Infants Suicids MainCty Wealth Commerc Clergy Crm_prn Infntcd</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; NA    5098   33120   35039       2     73      58     11      71      60</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;    Dntn_cl Lottery Desertn Instrct Prsttts Distanc Area Pop1831 TopCrm</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; NA      69      41      55      46      13 218.372 5762  346.03      1</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;    TopLit TopWealth</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; NA      0         1</span></a></code></pre></div>
<p>得到第3，5列的数据</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">guerry_df[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt;       AVE_ID_ Region</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; NA         49      E</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; NA.1      812      N</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; NA.2     1418      C</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; NA.3     1603      E</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; NA.4     1802      E</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; NA.5     2249      S</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; NA.6    35395      N</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; NA.7     2526      S</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; NA.8    34410      E</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; NA.9     2807      S</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; NA.10    3369      S</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; NA.11    3515      S</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt; NA.12    3667      N</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt; NA.13    4268      C</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; NA.14    4527      W</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; NA.15    5205      W</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; NA.16    5417      C</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; NA.17    5942      C</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; NA.18    6174      E</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; NA.19   33634      W</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; NA.20    6735      C</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; NA.21    7186      W</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt; NA.22    7482      E</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt; NA.23    8370      E</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt; NA.24    8612      N</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt; NA.25    9143      C</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt; NA.26    9659      W</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt; NA.27   10264      S</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt; NA.28   10962      S</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt; NA.29   11008      S</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt; NA.30   11520      W</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; NA.31   12162      S</span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt; NA.32   12532      W</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt; NA.33   12687      C</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt; NA.34   13147      C</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="co">#&gt; NA.35   13341      E</span></a>
<a class="sourceLine" id="cb9-39" data-line-number="39"><span class="co">#&gt; NA.36   13977      E</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40"><span class="co">#&gt; NA.37   14431      W</span></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="co">#&gt; NA.38   14589      C</span></a>
<a class="sourceLine" id="cb9-42" data-line-number="42"><span class="co">#&gt; NA.39   15070      C</span></a>
<a class="sourceLine" id="cb9-43" data-line-number="43"><span class="co">#&gt; NA.40   15339      C</span></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co">#&gt; NA.41   15550      W</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45"><span class="co">#&gt; NA.42   15881      C</span></a>
<a class="sourceLine" id="cb9-46" data-line-number="46"><span class="co">#&gt; NA.43   16029      S</span></a>
<a class="sourceLine" id="cb9-47" data-line-number="47"><span class="co">#&gt; NA.44   16326      W</span></a>
<a class="sourceLine" id="cb9-48" data-line-number="48"><span class="co">#&gt; NA.45   16732      S</span></a>
<a class="sourceLine" id="cb9-49" data-line-number="49"><span class="co">#&gt; NA.46   16834      W</span></a>
<a class="sourceLine" id="cb9-50" data-line-number="50"><span class="co">#&gt; NA.47   17502      N</span></a>
<a class="sourceLine" id="cb9-51" data-line-number="51"><span class="co">#&gt; NA.48   36143      N</span></a>
<a class="sourceLine" id="cb9-52" data-line-number="52"><span class="co">#&gt; NA.49   34913      E</span></a>
<a class="sourceLine" id="cb9-53" data-line-number="53"><span class="co">#&gt; NA.50   17708      W</span></a>
<a class="sourceLine" id="cb9-54" data-line-number="54"><span class="co">#&gt; NA.51   18215      E</span></a>
<a class="sourceLine" id="cb9-55" data-line-number="55"><span class="co">#&gt; NA.52   18431      N</span></a>
<a class="sourceLine" id="cb9-56" data-line-number="56"><span class="co">#&gt; NA.53   19153      W</span></a>
<a class="sourceLine" id="cb9-57" data-line-number="57"><span class="co">#&gt; NA.54   19575      N</span></a>
<a class="sourceLine" id="cb9-58" data-line-number="58"><span class="co">#&gt; NA.55   20037      C</span></a>
<a class="sourceLine" id="cb9-59" data-line-number="59"><span class="co">#&gt; NA.56   36521      N</span></a>
<a class="sourceLine" id="cb9-60" data-line-number="60"><span class="co">#&gt; NA.57   20823      N</span></a>
<a class="sourceLine" id="cb9-61" data-line-number="61"><span class="co">#&gt; NA.58   21456      N</span></a>
<a class="sourceLine" id="cb9-62" data-line-number="62"><span class="co">#&gt; NA.59   21990      N</span></a>
<a class="sourceLine" id="cb9-63" data-line-number="63"><span class="co">#&gt; NA.60   22829      C</span></a>
<a class="sourceLine" id="cb9-64" data-line-number="64"><span class="co">#&gt; NA.61   23572      W</span></a>
<a class="sourceLine" id="cb9-65" data-line-number="65"><span class="co">#&gt; NA.62   24112      S</span></a>
<a class="sourceLine" id="cb9-66" data-line-number="66"><span class="co">#&gt; NA.63   24280      S</span></a>
<a class="sourceLine" id="cb9-67" data-line-number="67"><span class="co">#&gt; NA.64   24814      E</span></a>
<a class="sourceLine" id="cb9-68" data-line-number="68"><span class="co">#&gt; NA.65   24947      E</span></a>
<a class="sourceLine" id="cb9-69" data-line-number="69"><span class="co">#&gt; NA.66   25381      E</span></a>
<a class="sourceLine" id="cb9-70" data-line-number="70"><span class="co">#&gt; NA.67   26063      E</span></a>
<a class="sourceLine" id="cb9-71" data-line-number="71"><span class="co">#&gt; NA.68   26357      E</span></a>
<a class="sourceLine" id="cb9-72" data-line-number="72"><span class="co">#&gt; NA.69   26842      C</span></a>
<a class="sourceLine" id="cb9-73" data-line-number="73"><span class="co">#&gt; NA.70   31560      N</span></a>
<a class="sourceLine" id="cb9-74" data-line-number="74"><span class="co">#&gt; NA.71   28118      N</span></a>
<a class="sourceLine" id="cb9-75" data-line-number="75"><span class="co">#&gt; NA.72   28566      N</span></a>
<a class="sourceLine" id="cb9-76" data-line-number="76"><span class="co">#&gt; NA.73   31598      N</span></a>
<a class="sourceLine" id="cb9-77" data-line-number="77"><span class="co">#&gt; NA.74   29204      W</span></a>
<a class="sourceLine" id="cb9-78" data-line-number="78"><span class="co">#&gt; NA.75   29360      N</span></a>
<a class="sourceLine" id="cb9-79" data-line-number="79"><span class="co">#&gt; NA.76   30128      S</span></a>
<a class="sourceLine" id="cb9-80" data-line-number="80"><span class="co">#&gt; NA.77   30546      S</span></a>
<a class="sourceLine" id="cb9-81" data-line-number="81"><span class="co">#&gt; NA.78   30753      S</span></a>
<a class="sourceLine" id="cb9-82" data-line-number="82"><span class="co">#&gt; NA.79   30777      S</span></a>
<a class="sourceLine" id="cb9-83" data-line-number="83"><span class="co">#&gt; NA.80   31097      W</span></a>
<a class="sourceLine" id="cb9-84" data-line-number="84"><span class="co">#&gt; NA.81   31387      W</span></a>
<a class="sourceLine" id="cb9-85" data-line-number="85"><span class="co">#&gt; NA.82   31564      C</span></a>
<a class="sourceLine" id="cb9-86" data-line-number="86"><span class="co">#&gt; NA.83   31810      E</span></a>
<a class="sourceLine" id="cb9-87" data-line-number="87"><span class="co">#&gt; NA.84   32129      C</span></a></code></pre></div>
<p>得到名为’Crm_prs’列的数据</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">guerry_df[<span class="st">'Crm_prs'</span>]</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;       Crm_prs</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; NA      28870</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; NA.1    26226</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; NA.2    26747</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; NA.3    12935</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; NA.4    17488</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; NA.5     9474</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; NA.6    35203</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; NA.7     6173</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; NA.8    19602</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; NA.9    15647</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; NA.10    8236</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; NA.11   13409</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; NA.12   17577</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; NA.13   18070</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; NA.14   24964</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; NA.15   18712</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; NA.16   21934</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; NA.17   15262</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; NA.18   32256</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt; NA.19   28607</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; NA.20   37014</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; NA.21   21585</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; NA.22   11560</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#&gt; NA.23   13396</span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt; NA.24   14795</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt; NA.25   21368</span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt; NA.26   29872</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt; NA.27   13115</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#&gt; NA.28   18642</span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co">#&gt; NA.29   18642</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co">#&gt; NA.30   24096</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="co">#&gt; NA.31   12814</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="co">#&gt; NA.32   22138</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="co">#&gt; NA.33   32404</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt; NA.34   19131</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt; NA.35   18785</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt; NA.36   26221</span></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#&gt; NA.37   17687</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="co">#&gt; NA.38   21292</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="co">#&gt; NA.39   27491</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="co">#&gt; NA.40   16170</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="co">#&gt; NA.41   19314</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="co">#&gt; NA.42   17722</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="co">#&gt; NA.43    5883</span></a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="co">#&gt; NA.44   22969</span></a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="co">#&gt; NA.45    7710</span></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"><span class="co">#&gt; NA.46   29692</span></a>
<a class="sourceLine" id="cb10-50" data-line-number="50"><span class="co">#&gt; NA.47   31078</span></a>
<a class="sourceLine" id="cb10-51" data-line-number="51"><span class="co">#&gt; NA.48   15602</span></a>
<a class="sourceLine" id="cb10-52" data-line-number="52"><span class="co">#&gt; NA.49   26231</span></a>
<a class="sourceLine" id="cb10-53" data-line-number="53"><span class="co">#&gt; NA.50   28331</span></a>
<a class="sourceLine" id="cb10-54" data-line-number="54"><span class="co">#&gt; NA.51   26674</span></a>
<a class="sourceLine" id="cb10-55" data-line-number="55"><span class="co">#&gt; NA.52   24507</span></a>
<a class="sourceLine" id="cb10-56" data-line-number="56"><span class="co">#&gt; NA.53   23316</span></a>
<a class="sourceLine" id="cb10-57" data-line-number="57"><span class="co">#&gt; NA.54   12153</span></a>
<a class="sourceLine" id="cb10-58" data-line-number="58"><span class="co">#&gt; NA.55   25087</span></a>
<a class="sourceLine" id="cb10-59" data-line-number="59"><span class="co">#&gt; NA.56   26740</span></a>
<a class="sourceLine" id="cb10-60" data-line-number="60"><span class="co">#&gt; NA.57   28180</span></a>
<a class="sourceLine" id="cb10-61" data-line-number="61"><span class="co">#&gt; NA.58   28329</span></a>
<a class="sourceLine" id="cb10-62" data-line-number="62"><span class="co">#&gt; NA.59   23101</span></a>
<a class="sourceLine" id="cb10-63" data-line-number="63"><span class="co">#&gt; NA.60   17256</span></a>
<a class="sourceLine" id="cb10-64" data-line-number="64"><span class="co">#&gt; NA.61   16722</span></a>
<a class="sourceLine" id="cb10-65" data-line-number="65"><span class="co">#&gt; NA.62   12223</span></a>
<a class="sourceLine" id="cb10-66" data-line-number="66"><span class="co">#&gt; NA.63    6728</span></a>
<a class="sourceLine" id="cb10-67" data-line-number="67"><span class="co">#&gt; NA.64   12309</span></a>
<a class="sourceLine" id="cb10-68" data-line-number="68"><span class="co">#&gt; NA.65    7343</span></a>
<a class="sourceLine" id="cb10-69" data-line-number="69"><span class="co">#&gt; NA.66   18793</span></a>
<a class="sourceLine" id="cb10-70" data-line-number="70"><span class="co">#&gt; NA.67   22339</span></a>
<a class="sourceLine" id="cb10-71" data-line-number="71"><span class="co">#&gt; NA.68   28391</span></a>
<a class="sourceLine" id="cb10-72" data-line-number="72"><span class="co">#&gt; NA.69   33913</span></a>
<a class="sourceLine" id="cb10-73" data-line-number="73"><span class="co">#&gt; NA.70   13945</span></a>
<a class="sourceLine" id="cb10-74" data-line-number="74"><span class="co">#&gt; NA.71   18355</span></a>
<a class="sourceLine" id="cb10-75" data-line-number="75"><span class="co">#&gt; NA.72   22201</span></a>
<a class="sourceLine" id="cb10-76" data-line-number="76"><span class="co">#&gt; NA.73   12477</span></a>
<a class="sourceLine" id="cb10-77" data-line-number="77"><span class="co">#&gt; NA.74   18400</span></a>
<a class="sourceLine" id="cb10-78" data-line-number="78"><span class="co">#&gt; NA.75   33592</span></a>
<a class="sourceLine" id="cb10-79" data-line-number="79"><span class="co">#&gt; NA.76   13019</span></a>
<a class="sourceLine" id="cb10-80" data-line-number="80"><span class="co">#&gt; NA.77   14790</span></a>
<a class="sourceLine" id="cb10-81" data-line-number="81"><span class="co">#&gt; NA.78   13145</span></a>
<a class="sourceLine" id="cb10-82" data-line-number="82"><span class="co">#&gt; NA.79   13576</span></a>
<a class="sourceLine" id="cb10-83" data-line-number="83"><span class="co">#&gt; NA.80   20827</span></a>
<a class="sourceLine" id="cb10-84" data-line-number="84"><span class="co">#&gt; NA.81   15010</span></a>
<a class="sourceLine" id="cb10-85" data-line-number="85"><span class="co">#&gt; NA.82   16256</span></a>
<a class="sourceLine" id="cb10-86" data-line-number="86"><span class="co">#&gt; NA.83   18835</span></a>
<a class="sourceLine" id="cb10-87" data-line-number="87"><span class="co">#&gt; NA.84   18006</span></a></code></pre></div>
<p>注意：上面的代码返回的结果是一个data.frame，如果需要得到该列的数值数据：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">crm_prs &lt;-<span class="st"> </span>guerry_df[<span class="st">'Crm_prs'</span>][,<span class="dv">1</span>]</a></code></pre></div>
<p>如果想根据名称来取得多个列的数据则可以扩展上面的代码为：</p>
<p>得到名为:Crm_prs, Crm_prp的数据</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">crm_prs_prp &lt;-<span class="st"> </span>guerry_df[<span class="kw">c</span>(<span class="st">'Crm_prs'</span>, <span class="st">'Crm_prp'</span>)]</a></code></pre></div>
</div>
</div>
<div class="section level2">
<h2>3. 空间权重</h2>
<p>空间权重是空间数据分析的核心组成部分。空间权重表示空间中观测值之间可能存在的空间相互作用。像GeoDa桌面软件一样，rgeoda提供了多种方法来创建几种不同类型的空间权重：</p>
<ul>
<li>基于邻接的权重Contiguity Based Weights: <code>queen_weights()</code>, <code>rook_weights()</code></li>
<li>基于距离的权重Distance Based Weights: <code>distance_weights()</code></li>
<li>K最近邻居权重: <code>knn_weights()</code></li>
<li>基于核函数的距离权重: <code>distance_weights()</code> and <code>knn_weights()</code> with kernel parameters</li>
</ul>
<div id="queen" class="section level3">
<h3>3.1 Queen邻接权重</h3>
<p>要创建Queen邻接权重，我们可以调用函数：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">gda_queen</span>(gda, <span class="dt">order=</span><span class="dv">1</span>, <span class="dt">include_lower_order =</span> False, <span class="dt">precision_threshold =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>使用我们刚刚创建的GeoDa对象guerry作为参数：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">queen_w &lt;-<span class="st"> </span><span class="kw">queen_weights</span>(guerry)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">summary</span>(queen_w)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; 2           weights type:          gal_type</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; 3           is symmetric:              TRUE</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt; 5                 density: 5.81314878892734</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; 6         # min neighbors:                2</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; 7         # max neighbors:                8</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; 8        # mean neighbors: 4.94117647058824</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; 9      # median neighbors:                5</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
<p>该函数queen_weights()返回一个Weight对象实例。通过访问该对象的属性，可以访问空间权重的元数据：</p>
<div id="attributes-of-weight-object" class="section level4">
<h4>Attributes of <code>Weight</code> object</h4>
<p>检查权重矩阵是否为对称矩阵：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">is_symmetric</span>(queen_w)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">has_isolates</span>(queen_w)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">weights_sparsity</span>(queen_w)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">weights_density</span>(queen_w)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; [1] 5.813149</span></a></code></pre></div>
<p>我们还可以访问权重的详细信息：例如，列出指定观察值的邻居，这对探索性空间数据分析（将在下一个教程中重点介绍）非常有帮助：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">nbrs &lt;-<span class="st"> </span><span class="kw">get_neighbors</span>(queen_w, <span class="dt">idx =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Neighbors of 1-st observation are:&quot;</span>, nbrs)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt; Neighbors of 1-st observation are: 36 37 67 69</span></a></code></pre></div>
<p>我们还可以通过传递某个选中变量的值来计算指定观测值的空间滞后(spatial lag)，比如计算第一个对象在Queen权重下的空间滞后的值（邻居的值进行空间加权后的和）：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">lag0 &lt;-<span class="st"> </span><span class="kw">spatial_lag</span>(queen_w, <span class="dt">idx =</span> <span class="dv">1</span>, <span class="dt">values =</span> crm_prs)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Spatial lag of 1-st observation is:&quot;</span>, lag0)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; Spatial lag of 1-st observation is: 23047.5</span></a></code></pre></div>
</div>
</div>
<div id="rook" class="section level3">
<h3>3.2 Rook连续性权重</h3>
<p>要创建Rook邻接权重，我们可以调用函数：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">rook_weights</span>(gda, <span class="dt">order=</span><span class="dv">1</span>,<span class="dt">include_lower_order=</span>False, <span class="dt">precision_threshold =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>例如：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">rook_w &lt;-<span class="st"> </span><span class="kw">rook_weights</span>(guerry)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">summary</span>(rook_w)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; 2           weights type:          gal_type</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; 3           is symmetric:              TRUE</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; 5                 density: 5.81314878892734</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; 6         # min neighbors:                2</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; 7         # max neighbors:                8</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; 8        # mean neighbors: 4.94117647058824</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; 9      # median neighbors:                5</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
<p>请注意：我们创建的权重位于内存中，这使其可以直接进行空间数据分析，也方便您调用rgeoda来编写应用程序。如果要将权重保存到文件中，可以调用函数：</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">save_weights</span>(gda_w, out_path, layer_name, id_name, id_values)</a></code></pre></div>
<p><code>out_path</code> 为保存文件的路径，比如：c:/test/guerry.gal</p>
<p><code>layer_name</code>是被加载的数据集的层名称。对于ESRI shapefile，<code>layer_name</code>是不带后缀的文件名（例如Guerry）。</p>
<p><code>id_name</code>是一个键值（某个列的名称），切该列中仅包含唯一值（没有重复的值），这样可以确保权重可以对应到原始数据中的正确的观察对象。</p>
<p><code>id_values</code>则是实际<code>id_name</code>列的数据，它可以是整数或字符串值类型。</p>
<p>例如，在Guerry数据集中，“ CODE_DE”列可用作保存权重文件的键（id_name)：</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">save_weights</span>(rook_w, <span class="dt">out_path =</span> <span class="st">'/Users/xun/Downloads/Guerry_r.gal'</span>, </a>
<a class="sourceLine" id="cb24-2" data-line-number="2">             <span class="dt">layer_name =</span> <span class="st">'Guerry'</span>, </a>
<a class="sourceLine" id="cb24-3" data-line-number="3">             <span class="dt">id_name =</span> <span class="st">'CODE_DE'</span>, </a>
<a class="sourceLine" id="cb24-4" data-line-number="4">             <span class="dt">id_values =</span> <span class="kw">as.integer</span>(guerry_df[<span class="st">'CODE_DE'</span>][,<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>运行成功后，我们应该在输出目录可以中找到生成的空间权重文件“ Guerry_r.gal”</p>
</div>
<div class="section level3">
<h3>3.3 基于距离的权重</h3>
<p>要创建基于距离的权重，我们可以调用函数:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">distance_weights</span>(geoda_obj, dist_thres, <span class="dt">power=</span><span class="fl">1.0</span>,  <span class="dt">is_inverse=</span>False, <span class="dt">is_arc=</span>False, <span class="dt">is_mile=</span>True)</a></code></pre></div>
<p>通过传递刚创建的GeoDa对象guerry和距离阈值dist_thres。像GeoDa软件一样，rgeoda提供了一个函数来帮助您找到合适的距离阈值: min_distthreshold()。该函数返回的距离阈值可确保每个观测值至少具有一个邻居。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">min_distthreshold</span>(GeoDa gda, bool <span class="dt">is_arc =</span> False, bool <span class="dt">is_mile =</span> True)</a></code></pre></div>
<p>请注意：该距离阈值并不适合于所有的情况，比如在基于核函数的空间权重创建中，较大的距离阈值会得到比较好的空间权重。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">dist_thres &lt;-<span class="st"> </span><span class="kw">min_distthreshold</span>(guerry)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">dist_w &lt;-<span class="st"> </span><span class="kw">distance_weights</span>(guerry, dist_thres)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw">summary</span>(dist_w)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt; 2           weights type:          gwt_type</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; 3           is symmetric:             FALSE</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt; 5                 density: 4.34602076124567</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; 6         # min neighbors:                1</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt; 7         # max neighbors:                7</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#&gt; 8        # mean neighbors: 3.69411764705882</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#&gt; 9      # median neighbors:                4</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
</div>
<div id="k" class="section level3">
<h3>3.4 K最近邻空间权重</h3>
<p>K最近邻空间权重是基于距离权重的一种特殊情况，其中每个观测值将恰好具有k个邻居。要创建K最近邻空间权重，我们可以调用函数：</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">knn_weights</span>(gda, k, <span class="dt">power =</span> <span class="fl">1.0</span>, <span class="dt">is_inverse =</span> False, <span class="dt">is_arc =</span> False, <span class="dt">is_mile =</span> True)</a></code></pre></div>
<p>例如，使用Guerry数据集创建6个最近邻的空间权重：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">knn6_w &lt;-<span class="st"> </span><span class="kw">knn_weights</span>(guerry, <span class="dt">k=</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw">summary</span>(knn6_w)</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="co">#&gt; 2           weights type:          gwt_type</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co">#&gt; 3           is symmetric:             FALSE</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co">#&gt; 5                 density: 7.05882352941176</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co">#&gt; 6         # min neighbors:                6</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10"><span class="co">#&gt; 7         # max neighbors:                6</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="co">#&gt; 8        # mean neighbors:                6</span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="co">#&gt; 9      # median neighbors:                6</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
</div>
<div class="section level3">
<h3>3.5 基于核函数的空间权重</h3>
<p>基于核函数的空间权重是另一种基于距离的空间权重，其应用核函数来确定权重值如何在距离上衰减。核函数不直接作用于对象i与对象j之间的距离dij，而是距离与设定距离阈值的比率z=dij/hi：K(z)。和GeoDa桌面软件一样，rgeoda提供的核函数包括了：</p>
<ul>
<li>triangular</li>
<li>uniform</li>
<li>quadratic</li>
<li>epanechnikov</li>
<li>quartic</li>
<li>gaussian</li>
</ul>
<p>根据设定距离阈值的方式，基于核函数的空间权重创建方分为两种：固定带宽的核函数空间权重，和自适应带宽的核函数空间权重。</p>
<div class="section level4">
<h4>3.5.1 固定带宽的核函数空间权重</h4>
<p>您可以使用下面的函数创建固定带宽的核函数空间权重:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">bandwidth &lt;-<span class="st"> </span><span class="kw">min_distthreshold</span>(guerry)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">kernel_w &lt;-<span class="st"> </span><span class="kw">kernel_weights</span>(guerry, bandwidth, <span class="dt">kernel_method =</span> <span class="st">&quot;uniform&quot;</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="kw">summary</span>(kernel_w)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#&gt; 2           weights type:          gwt_type</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#&gt; 3           is symmetric:             FALSE</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#&gt; 5                 density: 4.34602076124567</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="co">#&gt; 6         # min neighbors:                1</span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co">#&gt; 7         # max neighbors:                7</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co">#&gt; 8        # mean neighbors: 3.69411764705882</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="co">#&gt; 9      # median neighbors:                4</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
<p>其中参数<code>is_inverse</code>, <code>power</code>, <code>is_arc</code> 和<code>is_mile</code> 与函数distance_weights() knn_weights()一样，除此之外该函数还提供了另外一个核函数相关的参数：</p>
<pre><code>use_kernel_diagonals    
(optional) FALSE (default) or TRUE, apply kernel on the diagonal of weights matrix</code></pre>
<p>该参数决定空间权重矩阵的对角线上的值为1还是Kernel(0)。这也是基于 核函数的空间权重和普通的基于距离的空间权重的区别。</p>
</div>
<div class="section level4">
<h4>3.5.2 自适应带宽的核函数空间权重</h4>
<p>您可以使用下面的函数创建自适应带宽的核函数空间权重:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">adptkernel_w =<span class="st"> </span><span class="kw">kernel_knn_weights</span>(guerry, <span class="dv">6</span>, <span class="st">&quot;uniform&quot;</span>)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">summary</span>(adptkernel_w)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt;                       name            value</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">#&gt; 1  number of observations:               85</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co">#&gt; 2           weights type:          gwt_type</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co">#&gt; 3           is symmetric:             FALSE</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="co">#&gt; 4                sparsity:                0</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="co">#&gt; 5                 density: 7.05882352941176</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="co">#&gt; 6         # min neighbors:                6</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="co">#&gt; 7         # max neighbors:                6</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="co">#&gt; 8        # mean neighbors:                6</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="co">#&gt; 9      # median neighbors:                6</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="co">#&gt; 10           has isolates:            FALSE</span></a></code></pre></div>
<p>This kernel weights function two more options: 除了<code>use_kernel_diagonals</code>参数外，该函数还提供了另外一个参数来控制如何使用自适应带宽：</p>
<pre><code>adaptive_bandwidth  
(optional) TRUE (default) or FALSE: TRUE use adaptive bandwidth calculated using distance of k-nearest neithbors, FALSE use max distance of all observation to their k-nearest neighbors</code></pre>
<p>该参数决定是否使用所有对象使用相同的带宽(到第K个邻居之间距离的最大值)，还是每个对象都使用不同的带宽（到K个邻居的距离）。</p>
</div>
</div>
</div>
<div class="section level2">
<h2>4 空间数据分析</h2>
<div class="section level3">
<h3>4.1 局部空间自相关分析</h3>
<p>rgeoda 0.0.4提供了下列局部空间自相关统计的方法：</p>
<ul>
<li>Local Moran: local_moran()</li>
<li>Local Geary: local_geary(), local_multigeary()</li>
<li>Local Getis-Ord statistics: local_g() and local_gstar()</li>
<li>Local Join Count: local_joincount(), local_multijoincount()</li>
<li>Quantile LISA: local_quantilelisa()</li>
</ul>
<p>下一个版本的rgeoda将包含用于更多的局部空间自相关统计以及全局空间自相关统计的方法。</p>
<p>在本教程中，我们将仅介绍如何使用pygeoda调用这些方法。有关局部空间自相关统计信息的更多信息，请阅读：http : //geodacenter.github.io/workbook/6a_local_auto/lab6a.html。</p>
<div id="local-moran" class="section level4">
<h4>4.1.1 Local Moran</h4>
<p>局部Moran统计量是一种识别局部聚类和局部空间离群值的方法。例如，我们可以调用<code>local_moran()</code>, 并使用创建的空间权重<code>queen_w</code>和数据<code>crm_prp</code>作为输入参数：</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_moran</span>(queen_w, crm_prs)</a></code></pre></div>
<p>该local_moran()函数将返回一个LISA对象，该对象存储了局部空间自相关分析计算的结果。</p>
<p>例如，我们可以调用该函数<code>lisa_values(lisa_obj)</code>以获取本地Moran的值：</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">lms &lt;-<span class="st"> </span><span class="kw">lisa_values</span>(<span class="dt">gda_lisa =</span> lisa)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">lms</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co">#&gt;  [1]  0.516120231  0.818275138  0.794086560  0.733161543  0.228467334</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="co">#&gt;  [6]  0.829040272  0.615280448  1.627415446 -0.019525625  0.687081885</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="co">#&gt; [11]  1.707896579  0.821748275 -0.213568315  0.291316827 -0.184833414</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co">#&gt; [16] -0.047198613  0.249972417  0.054411195  0.862095943  0.835368441</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="co">#&gt; [21]  0.538432168 -0.050446242 -0.681022658  0.678851849 -0.105369231</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co">#&gt; [26]  0.038567922  1.116236578  1.168138859  0.162030880  0.069037225</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="co">#&gt; [31]  0.021522359  1.000255304  0.276308094  0.423159405 -0.101271972</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="co">#&gt; [36]  0.015647332  0.554846307 -0.027584417  0.111200075 -0.082994402</span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="co">#&gt; [41]  0.281817532 -0.048962443 -0.015839144  0.830286100 -0.160743989</span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="co">#&gt; [46]  1.597607483  0.396712769  0.862342357 -0.466396879  0.262343383</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="co">#&gt; [51]  1.424738721 -0.379247703  0.388066026  0.316231271  0.068795845</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14"><span class="co">#&gt; [56]  0.405538158  0.977019076  0.202610060  0.714533504  0.601447598</span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15"><span class="co">#&gt; [61] -0.177594467  0.229608404  0.284505927  2.247991283  0.532787318</span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16"><span class="co">#&gt; [66]  1.039424040 -0.129846379  0.136565215  1.033851456  1.238521154</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17"><span class="co">#&gt; [71]  0.296054062 -0.167632280 -0.041663121  0.036396148 -0.055081083</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="co">#&gt; [76]  1.166507105  0.773315084  0.523682291  0.851277285  0.884651013</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19"><span class="co">#&gt; [81]  0.025497212 -0.326497225 -0.306819894  0.001277301 -0.125219240</span></a></code></pre></div>
<p>调用<code>lisa_pvalues()</code>来获得局部Moran统计中显著性意义的伪p值:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">pvals &lt;-<span class="st"> </span><span class="kw">lisa_pvalues</span>(lisa)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">pvals</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="co">#&gt;  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co">#&gt; [12] 0.059 0.157 0.006 0.291 0.271 0.012 0.440 0.058 0.101 0.263 0.267</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="co">#&gt; [23] 0.214 0.044 0.356 0.295 0.124 0.001 0.010 0.177 0.448 0.008 0.007</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="co">#&gt; [34] 0.262 0.033 0.389 0.081 0.462 0.056 0.443 0.116 0.139 0.445 0.115</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co">#&gt; [45] 0.196 0.012 0.222 0.127 0.021 0.189 0.003 0.206 0.087 0.087 0.474</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8"><span class="co">#&gt; [56] 0.068 0.048 0.326 0.070 0.026 0.121 0.186 0.323 0.026 0.146 0.226</span></a>
<a class="sourceLine" id="cb36-9" data-line-number="9"><span class="co">#&gt; [67] 0.065 0.172 0.016 0.051 0.328 0.093 0.353 0.439 0.274 0.078 0.033</span></a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="co">#&gt; [78] 0.046 0.047 0.006 0.332 0.122 0.054 0.491 0.146</span></a></code></pre></div>
<p>获取局部Moran计算的聚类类别:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">cats &lt;-<span class="st"> </span><span class="kw">lisa_clusters</span>(lisa, <span class="dt">cutoff =</span> <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">cats</a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="co">#&gt;  [1] 0 1 1 0 0 2 0 2 0 2 2 0 0 2 0 0 1 0 0 0 0 0 0 2 0 0 0 2 2 0 0 2 1 0 3</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 2 0 0 3 0 1 0 0 0 0 0 1 0 0 1 0 0 0 2 0 0 0 0 1 0</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="co">#&gt; [71] 0 0 0 0 0 0 2 2 2 2 0 0 0 0 0</span></a></code></pre></div>
<p>Local Moran聚类类别的预定义值为：</p>
<pre><code>0 不显著
1 高-高
2 低-低
3 高-低
4 低-高
5 无邻居
6 未定以值</code></pre>
<p>不同的局部自相关分析方法设定的聚类类别值分别不同，可以调用方法<code>lisa_labels()</code>查看:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">lbls &lt;-<span class="st"> </span><span class="kw">lisa_labels</span>(lisa)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">lbls</a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="co">#&gt; [1] &quot;Not significant&quot; &quot;High-High&quot;       &quot;Low-Low&quot;         &quot;High-Low&quot;       </span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="co">#&gt; [5] &quot;Low-High&quot;        &quot;Undefined&quot;       &quot;Isolated&quot;</span></a></code></pre></div>
<p>根据当前的p值计算伪发现率FDR</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">fdr&lt;-<span class="kw">lisa_fdr</span>(lisa, <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">fdr</a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co">#&gt; [1] 0.0005882353</span></a></code></pre></div>
<p>你可以设置FDR值伪p值的阈值来重新得到本地Moran的聚类结果：</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">cat_fdr&lt;-<span class="kw">lisa_clusters</span>(lisa, <span class="dt">cutoff =</span> fdr)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">cat_fdr</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="co">#&gt; [71] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a></code></pre></div>
<p>默认情况下，该local_moran()函数将使用一些默认参数运行，例如:</p>
<p>随机置换的次数permutation number: 999 计算CPU线程的数量ncpus: 8</p>
<p>这些配置和GeoDa桌面软件相同，因此我们在rgeoda中重复与GeoDa相同的运算结果。</p>
<p>rgeoda的函数也提供的不同的参数来设置，比如：不同的随机置换次数，和不同的CPU线程数。</p>
<p>例如，使用9999个排列重新运行上述本地Moran示例</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_moran</span>(queen_w, crm_prs, <span class="dt">perm =</span> <span class="dv">9999</span>)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">pvals &lt;-<span class="st"> </span><span class="kw">lisa_pvalues</span>(lisa)</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">pvals</a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="co">#&gt;  [1] 0.1942 0.0060 0.0110 0.0588 0.1209 0.0474 0.2793 0.0575 0.1797 0.0019</span></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co">#&gt; [11] 0.0010 0.0526 0.1243 0.0014 0.2826 0.2657 0.0086 0.4217 0.0653 0.1042</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="co">#&gt; [21] 0.2465 0.2780 0.2143 0.0346 0.3559 0.2979 0.1282 0.0004 0.0104 0.1696</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7"><span class="co">#&gt; [31] 0.4553 0.0144 0.0081 0.2486 0.0195 0.4145 0.0663 0.4199 0.0582 0.4319</span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8"><span class="co">#&gt; [41] 0.1052 0.1336 0.4399 0.1327 0.1804 0.0091 0.1682 0.1132 0.0265 0.2106</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="co">#&gt; [51] 0.0012 0.2102 0.0717 0.0814 0.4704 0.0721 0.0335 0.3037 0.0516 0.0248</span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="co">#&gt; [61] 0.1130 0.1854 0.3274 0.0319 0.1417 0.2035 0.0496 0.1692 0.0047 0.0416</span></a>
<a class="sourceLine" id="cb42-11" data-line-number="11"><span class="co">#&gt; [71] 0.3164 0.0950 0.3516 0.4568 0.2775 0.0685 0.0250 0.0257 0.0521 0.0028</span></a>
<a class="sourceLine" id="cb42-12" data-line-number="12"><span class="co">#&gt; [81] 0.3269 0.1139 0.0637 0.4934 0.1438</span></a></code></pre></div>
<p>rgeoda使用GeoDa的C ++代码，其中多线程用于加速LISA的计算。比如我们可以指定要运行多少线程：</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">lisa &lt;-<span class="st"> </span><span class="kw">local_moran</span>(queen_w, crm_prs, <span class="dt">ncpu =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="kw">lisa_pvalues</span>(lisa)</a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="co">#&gt;  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="co">#&gt; [12] 0.059 0.157 0.006 0.291 0.271 0.012 0.440 0.058 0.101 0.263 0.267</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="co">#&gt; [23] 0.214 0.044 0.356 0.295 0.124 0.001 0.010 0.177 0.448 0.008 0.007</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="co">#&gt; [34] 0.262 0.033 0.389 0.081 0.462 0.056 0.443 0.116 0.139 0.445 0.115</span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="co">#&gt; [45] 0.196 0.012 0.222 0.127 0.021 0.189 0.003 0.206 0.087 0.087 0.474</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="co">#&gt; [56] 0.068 0.048 0.326 0.070 0.026 0.121 0.186 0.323 0.026 0.146 0.226</span></a>
<a class="sourceLine" id="cb43-9" data-line-number="9"><span class="co">#&gt; [67] 0.065 0.172 0.016 0.051 0.328 0.093 0.353 0.439 0.274 0.078 0.033</span></a>
<a class="sourceLine" id="cb43-10" data-line-number="10"><span class="co">#&gt; [78] 0.046 0.047 0.006 0.332 0.122 0.054 0.491 0.146</span></a></code></pre></div>
</div>
<div id="geary" class="section level4">
<h4>4.1.2 局部Geary</h4>
<p>局部Geary是一种专注于平方差/差异性的局部自相关分析方法。本地Geary统计值的较小值表明空间自相关为正，而较大值表明空间自相关为负。而这种比较是和多次随机置换计算的平均本地Geary统计值进行的。</p>
<p>进行本地Geary计算，我们只需要调用方法<code>local_geary()</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">geary_crmprs &lt;-<span class="st"> </span><span class="kw">local_geary</span>(queen_w, crm_prs)</a></code></pre></div>
<p>要获取本地Geary计算的聚类指标：</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">lisa_clusters</span>(geary_crmprs)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="co">#&gt;  [1] 0 0 1 2 0 0 0 0 0 0 2 2 0 0 0 0 0 0 1 1 0 0 0 2 0 0 0 2 0 2 0 2 0 0 0</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 2 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="co">#&gt; [71] 0 0 0 0 0 1 2 0 2 2 0 0 4 0 0</span></a></code></pre></div>
<p>要获取本地Geary计算的伪p值：</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">lisa_pvalues</span>(geary_crmprs)</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="co">#&gt;  [1] 0.103 0.094 0.047 0.003 0.114 0.058 0.244 0.069 0.415 0.240 0.001</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="co">#&gt; [12] 0.001 0.168 0.387 0.287 0.062 0.365 0.222 0.019 0.042 0.251 0.400</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="co">#&gt; [23] 0.296 0.015 0.468 0.446 0.080 0.006 0.356 0.027 0.052 0.007 0.218</span></a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="co">#&gt; [34] 0.289 0.058 0.452 0.224 0.134 0.465 0.431 0.401 0.298 0.052 0.096</span></a>
<a class="sourceLine" id="cb46-6" data-line-number="6"><span class="co">#&gt; [45] 0.386 0.008 0.147 0.083 0.101 0.099 0.003 0.308 0.242 0.068 0.542</span></a>
<a class="sourceLine" id="cb46-7" data-line-number="7"><span class="co">#&gt; [56] 0.043 0.057 0.362 0.120 0.603 0.124 0.074 0.168 0.059 0.290 0.221</span></a>
<a class="sourceLine" id="cb46-8" data-line-number="8"><span class="co">#&gt; [67] 0.322 0.431 0.002 0.024 0.334 0.107 0.183 0.306 0.320 0.032 0.017</span></a>
<a class="sourceLine" id="cb46-9" data-line-number="9"><span class="co">#&gt; [78] 0.175 0.001 0.002 0.141 0.208 0.035 0.428 0.520</span></a></code></pre></div>
</div>
<div id="geary" class="section level4">
<h4>4.1.3 多元局部Geary:</h4>
<p>rgeoda也提供函数<code>local_multigeary()</code>来进行多变量的局部Geary计算，来分析多变量在局部的空间自相关性。</p>
<p>比如，分析6个变量Crm_prs, Crm_prp, Litercy, Donatns, Infants 和Suicides，他们的值在空间分布上，是否具有局部的空间自相关性。</p>
<p>请注意该“自相关”在局部Geary中指的是这些变量的值是否和观察对象邻居的值“相似”或者“不相似”。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">data &lt;-<span class="kw">as.list</span>(guerry_df[<span class="kw">c</span>(<span class="st">'Crm_prs'</span>,<span class="st">'Crm_prp'</span>,<span class="st">'Litercy'</span>,<span class="st">'Donatns'</span>,<span class="st">'Infants'</span>,<span class="st">'Suicids'</span>)])</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">multigeary &lt;-<span class="st"> </span><span class="kw">local_multigeary</span>(queen_w, data)</a></code></pre></div>
<p>要获取多元局部Geary计算的聚类指标：</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">lisa_clusters</span>(multigeary)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="co">#&gt;  [1] 0 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 1 1 1 1 1 0 1 1 1 1 1 0 1 0 0 1 0 0</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="co">#&gt; [36] 0 1 0 1 0 1 0 1 1 1 0 0 0 1 1 1 0 1 1 0 0 1 1 0 1 1 0 1 0 1 1 0 1 0 1</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="co">#&gt; [71] 1 0 1 1 0 1 1 1 1 1 0 1 0 1 1</span></a></code></pre></div>
</div>
<div id="-getis-ord-gg" class="section level4">
<h4>4.1.4 局部 Getis-Ord G/G*</h4>
<p>局部Getis-Ord G统计信息有两种类型：一种是计算邻近位置的值的加权平均，不包括该位置的值（Local G);而另一种统计量则包括分子和分母中的位置值(Local G*)。</p>
<p>如果观察对象i的值大于平均值则表示高-高或热区，小于平均值的值表示低-低或冷区。</p>
<p>For example, we can call the function <code>local_g()</code> with the created Queen weights and the data “crm_prp” as input parameters:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">localg_crmprs &lt;-<span class="st"> </span><span class="kw">local_g</span>(queen_w, crm_prs)</a></code></pre></div>
<p>To get the cluster indicators of the local G computation:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">lisa_clusters</span>(localg_crmprs)</a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="co">#&gt;  [1] 0 1 1 0 0 2 0 2 0 2 2 0 0 2 0 0 1 0 0 0 0 0 0 2 0 0 0 2 2 0 0 2 1 0 1</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 2 0 0 1 0 1 0 0 0 0 0 1 0 0 1 0 0 0 2 0 0 0 0 1 0</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"><span class="co">#&gt; [71] 0 0 0 0 0 0 2 2 2 2 0 0 0 0 0</span></a></code></pre></div>
<p>To get the pseudo-p values of the local G computation:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">lisa_pvalues</span>(localg_crmprs)</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="co">#&gt;  [1] 0.197 0.013 0.023 0.068 0.111 0.045 0.281 0.048 0.183 0.004 0.002</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="co">#&gt; [12] 0.059 0.158 0.006 0.291 0.271 0.012 0.440 0.058 0.101 0.263 0.267</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"><span class="co">#&gt; [23] 0.214 0.044 0.356 0.295 0.124 0.001 0.010 0.177 0.448 0.008 0.007</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="co">#&gt; [34] 0.262 0.033 0.389 0.081 0.462 0.056 0.443 0.116 0.139 0.445 0.115</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"><span class="co">#&gt; [45] 0.196 0.012 0.222 0.127 0.021 0.189 0.003 0.206 0.087 0.087 0.474</span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7"><span class="co">#&gt; [56] 0.068 0.048 0.326 0.070 0.026 0.121 0.186 0.323 0.026 0.146 0.224</span></a>
<a class="sourceLine" id="cb51-8" data-line-number="8"><span class="co">#&gt; [67] 0.065 0.172 0.016 0.051 0.327 0.093 0.353 0.439 0.274 0.078 0.033</span></a>
<a class="sourceLine" id="cb51-9" data-line-number="9"><span class="co">#&gt; [78] 0.046 0.047 0.006 0.332 0.122 0.054 0.491 0.146</span></a></code></pre></div>
<p>For the second type of local Getis-Ord statistics, we can call the function <code>local_gstar()</code> with the created Queen weights and the data “crm_prp” as input parameters:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">localgstar_crmprs &lt;-<span class="st"> </span><span class="kw">local_gstar</span>(queen_w, crm_prs)</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="kw">lisa_clusters</span>(localgstar_crmprs)</a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="co">#&gt;  [1] 0 1 1 0 0 2 0 2 0 2 2 0 0 2 0 0 1 0 0 0 0 0 0 2 0 0 0 2 2 0 0 2 1 0 1</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 2 0 0 1 0 1 0 0 0 0 0 1 0 0 1 0 0 0 2 0 0 0 0 1 0</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="co">#&gt; [71] 0 0 0 0 0 0 2 2 2 2 0 0 0 0 0</span></a></code></pre></div>
</div>
<div id="local-join-count" class="section level4">
<h4>4.1.5 Local Join Count</h4>
<p>Local Join Count is a method to identify local clusters for binary data by using a local version of the so-called BB join count statistic. The statistic is only meaningful for those observations with value 1.</p>
<p>For example, we can call the function <code>local_joincount()</code> with a Queen weights and the data “TopCrm”, which is a set of binary (0,1) values, as input parameters:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">top_crm &lt;-<span class="st"> </span>guerry_df[<span class="st">'TopCrm'</span>][,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">localjc_crm &lt;-<span class="st"> </span><span class="kw">local_joincount</span>(queen_w, top_crm)</a></code></pre></div>
<p>To get the cluster indicators of the local Join Count computation:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">lisa_clusters</span>(localjc_crm)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="co">#&gt; [71] 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0</span></a></code></pre></div>
<p>To get the pseudo-p values of the local Join Count computation:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">lisa_pvalues</span>(localjc_crm)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="co">#&gt;  [1] 0.395 0.085 0.094 0.001 0.001 0.001 0.231 0.001 0.001 0.001 0.001</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="co">#&gt; [12] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.136 0.256 0.370 0.001</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="co">#&gt; [23] 0.001 0.001 0.001 0.001 0.112 0.001 0.001 0.001 0.001 0.001 0.001</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="co">#&gt; [34] 0.094 0.001 0.001 0.195 0.001 0.001 0.274 0.001 0.001 0.001 0.001</span></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="co">#&gt; [45] 0.001 0.001 0.236 0.416 0.001 0.378 0.039 0.212 0.182 0.384 0.001</span></a>
<a class="sourceLine" id="cb55-7" data-line-number="7"><span class="co">#&gt; [56] 0.318 0.033 0.379 0.307 0.107 0.001 0.001 0.001 0.001 0.001 0.001</span></a>
<a class="sourceLine" id="cb55-8" data-line-number="8"><span class="co">#&gt; [67] 0.001 0.001 0.012 0.326 0.001 0.001 0.001 0.001 0.001 0.041 0.001</span></a>
<a class="sourceLine" id="cb55-9" data-line-number="9"><span class="co">#&gt; [78] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001</span></a></code></pre></div>
<p>To get the number of neighbors of the local Join Count computation:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">lisa_num_nbrs</span>(localjc_crm)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="co">#&gt;  [1] 4 6 6 4 3 7 3 3 5 5 7 3 3 6 5 5 6 6 7 3 6 7 2 5 6 6 2 6 6 6 4 4 6 6 5</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="co">#&gt; [36] 6 5 4 6 7 5 4 7 6 6 5 8 4 6 6 5 4 5 4 2 6 3 6 6 2 6 3 3 2 4 2 4 5 7 6</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="co">#&gt; [71] 2 3 8 6 5 5 5 6 3 6 4 6 6 6 5</span></a></code></pre></div>
</div>
<div id="multivariate-local-join-count" class="section level4">
<h4>4.1.6 Multivariate Local Join Count:</h4>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">bin_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(guerry_df[<span class="kw">c</span>(<span class="st">'TopWealth'</span>,<span class="st">'TopLit'</span>)])</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">multijc &lt;-<span class="st"> </span><span class="kw">local_multijoincount</span>(queen_w, bin_data)</a></code></pre></div>
<p>To get the cluster indicators of the multivariate local join count computation:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">lisa_clusters</span>(multijc)</a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="co">#&gt; [36] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0</span></a>
<a class="sourceLine" id="cb58-4" data-line-number="4"><span class="co">#&gt; [71] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a></code></pre></div>
</div>
<div id="quantile-lisa" class="section level4">
<h4>4.1.7 Quantile LISA</h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">qsa &lt;-<span class="st"> </span><span class="kw">local_quantilelisa</span>(queen_w, <span class="dv">4</span>, <span class="dv">1</span>, crm_prs)</a></code></pre></div>
<p>To get the cluster indicators of the quantile LISA computation:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">lisa_clusters</span>(qsa)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0</span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="co">#&gt; [36] 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1</span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="co">#&gt; [71] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span></a></code></pre></div>
</div>
</div>
<div id="spatializing-multivariate-analysis" class="section level3">
<h3>4.2 Spatializing Multivariate Analysis</h3>
<div id="pincinple-components" class="section level4">
<h4>4.2.1 Pincinple Components</h4>
<p>This PCA function aims to reproduce the PCA feature and results in GeoDa. However, one can use <code>prcomp</code> function in R to apply same PCA computations.</p>
<p>For example, the following example will apply PCA on 6 variables. The <code>standardize()</code> function is called to standardize the data, which <code>pca()</code> function applies on.</p>
<p>Other standardization functions include: <code>demean()</code> and <code>mad()</code>, which are same in GeoDa program.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="co">#data &lt;- as.list(guerry_df[c('Crm_prs','Crm_prp','Litercy','Donatns','Infants','Suicids')])</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2">std_data &lt;-<span class="st"> </span><span class="kw">standardize</span>(data)</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">pc &lt;-<span class="st"> </span><span class="kw">pca</span>(std_data)</a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="kw">summary</span>(pc)</a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="co">#&gt; $`PCA method: `</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="co">#&gt; [1] &quot;svd&quot;</span></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-8" data-line-number="8"><span class="co">#&gt; $`Standard Deviation:`</span></a>
<a class="sourceLine" id="cb61-9" data-line-number="9"><span class="co">#&gt; [1] 1.4630340 1.0958195 1.0497845 0.8166800 0.7407258 0.5839707</span></a>
<a class="sourceLine" id="cb61-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-11" data-line-number="11"><span class="co">#&gt; $`Proportion of variance:`</span></a>
<a class="sourceLine" id="cb61-12" data-line-number="12"><span class="co">#&gt; [1] 0.35674483 0.20013675 0.18367462 0.11116106 0.09144579 0.05683697</span></a>
<a class="sourceLine" id="cb61-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-14" data-line-number="14"><span class="co">#&gt; $`Cumulative proportion:`</span></a>
<a class="sourceLine" id="cb61-15" data-line-number="15"><span class="co">#&gt; [1] 0.3567448 0.5568815 0.7405562 0.8517172 0.9431630 1.0000000</span></a>
<a class="sourceLine" id="cb61-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-17" data-line-number="17"><span class="co">#&gt; $`Kaiser criterion:`</span></a>
<a class="sourceLine" id="cb61-18" data-line-number="18"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb61-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-20" data-line-number="20"><span class="co">#&gt; $`95% threshold criterion:`</span></a>
<a class="sourceLine" id="cb61-21" data-line-number="21"><span class="co">#&gt; [1] 5</span></a>
<a class="sourceLine" id="cb61-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-23" data-line-number="23"><span class="co">#&gt; $`Eigen Values:`</span></a>
<a class="sourceLine" id="cb61-24" data-line-number="24"><span class="co">#&gt; [1] 2.1404686 1.2008203 1.1020476 0.6669663 0.5486748 0.3410218</span></a>
<a class="sourceLine" id="cb61-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-26" data-line-number="26"><span class="co">#&gt; $`Variable Loadings:`</span></a>
<a class="sourceLine" id="cb61-27" data-line-number="27"><span class="co">#&gt; $`Variable Loadings:`[[1]]</span></a>
<a class="sourceLine" id="cb61-28" data-line-number="28"><span class="co">#&gt; [1] -0.06586844 -0.51232553  0.51175290 -0.10619514 -0.45133743 -0.50627047</span></a>
<a class="sourceLine" id="cb61-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-30" data-line-number="30"><span class="co">#&gt; $`Variable Loadings:`[[2]]</span></a>
<a class="sourceLine" id="cb61-31" data-line-number="31"><span class="co">#&gt; [1] -0.5123255  0.5117529 -0.1061951 -0.4513374 -0.5062705 -0.5905984</span></a>
<a class="sourceLine" id="cb61-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-33" data-line-number="33"><span class="co">#&gt; $`Variable Loadings:`[[3]]</span></a>
<a class="sourceLine" id="cb61-34" data-line-number="34"><span class="co">#&gt; [1]  0.5117529 -0.1061951 -0.4513374 -0.5062705 -0.5905984  0.0883673</span></a>
<a class="sourceLine" id="cb61-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-36" data-line-number="36"><span class="co">#&gt; $`Variable Loadings:`[[4]]</span></a>
<a class="sourceLine" id="cb61-37" data-line-number="37"><span class="co">#&gt; [1] -0.1061951 -0.4513374 -0.5062705 -0.5905984  0.0883673  0.1293611</span></a>
<a class="sourceLine" id="cb61-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-39" data-line-number="39"><span class="co">#&gt; $`Variable Loadings:`[[5]]</span></a>
<a class="sourceLine" id="cb61-40" data-line-number="40"><span class="co">#&gt; [1] -0.4513374 -0.5062705 -0.5905984  0.0883673  0.1293611 -0.6989980</span></a>
<a class="sourceLine" id="cb61-41" data-line-number="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-42" data-line-number="42"><span class="co">#&gt; $`Variable Loadings:`[[6]]</span></a>
<a class="sourceLine" id="cb61-43" data-line-number="43"><span class="co">#&gt; [1] -0.5062705 -0.5905984  0.0883673  0.1293611 -0.6989980 -0.1033123</span></a>
<a class="sourceLine" id="cb61-44" data-line-number="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-45" data-line-number="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-46" data-line-number="46"><span class="co">#&gt; $`Squared Correlations:`</span></a>
<a class="sourceLine" id="cb61-47" data-line-number="47"><span class="co">#&gt; $`Squared Correlations:`[[1]]</span></a>
<a class="sourceLine" id="cb61-48" data-line-number="48"><span class="co">#&gt; [1] 9.286812e-03 4.188536e-01 4.994276e-01 1.302188e-02 5.682668e-05</span></a>
<a class="sourceLine" id="cb61-49" data-line-number="49"><span class="co">#&gt; [6] 5.935308e-02</span></a>
<a class="sourceLine" id="cb61-50" data-line-number="50"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-51" data-line-number="51"><span class="co">#&gt; $`Squared Correlations:`[[2]]</span></a>
<a class="sourceLine" id="cb61-52" data-line-number="52"><span class="co">#&gt; [1] 0.561825454 0.009376963 0.250265568 0.006484959 0.010457415 0.161589921</span></a>
<a class="sourceLine" id="cb61-53" data-line-number="53"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-54" data-line-number="54"><span class="co">#&gt; $`Squared Correlations:`[[3]]</span></a>
<a class="sourceLine" id="cb61-55" data-line-number="55"><span class="co">#&gt; [1] 5.605701e-01 2.009490e-02 4.815156e-02 4.233069e-05 3.700718e-01</span></a>
<a class="sourceLine" id="cb61-56" data-line-number="56"><span class="co">#&gt; [6] 1.069382e-03</span></a>
<a class="sourceLine" id="cb61-57" data-line-number="57"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-58" data-line-number="58"><span class="co">#&gt; $`Squared Correlations:`[[4]]</span></a>
<a class="sourceLine" id="cb61-59" data-line-number="59"><span class="co">#&gt; [1] 0.02413891 0.58671862 0.18833773 0.14920925 0.04125461 0.01034097</span></a>
<a class="sourceLine" id="cb61-60" data-line-number="60"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-61" data-line-number="61"><span class="co">#&gt; $`Squared Correlations:`[[5]]</span></a>
<a class="sourceLine" id="cb61-62" data-line-number="62"><span class="co">#&gt; [1] 0.436025709 0.012816893 0.115551390 0.355727494 0.078226551 0.001651996</span></a>
<a class="sourceLine" id="cb61-63" data-line-number="63"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb61-64" data-line-number="64"><span class="co">#&gt; $`Squared Correlations:`[[6]]</span></a>
<a class="sourceLine" id="cb61-65" data-line-number="65"><span class="co">#&gt; [1] 0.5486234426 0.1529589146 0.0003130297 0.1424801946 0.0486078747</span></a>
<a class="sourceLine" id="cb61-66" data-line-number="66"><span class="co">#&gt; [6] 0.1070163175</span></a></code></pre></div>
<p>With the returned object <code>pc</code>, one can call <code>get_kcomponents()</code> function to get first K components:</p>
<p>For example, to get first 3 components</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">get_kcomponents</span>(pc, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="co">#&gt;  [1] -2.15079784  1.24630284 -2.07714891  0.60372376  0.96266198</span></a>
<a class="sourceLine" id="cb62-4" data-line-number="4"><span class="co">#&gt;  [6] -2.02217531  0.83754289 -2.31564236  1.71969211 -0.99525052</span></a>
<a class="sourceLine" id="cb62-5" data-line-number="5"><span class="co">#&gt; [11] -1.30435145  1.50636125  1.09195995 -1.42777729 -1.00126719</span></a>
<a class="sourceLine" id="cb62-6" data-line-number="6"><span class="co">#&gt; [16]  0.34988350 -1.24823558 -1.98039460  0.87822956 -2.18980956</span></a>
<a class="sourceLine" id="cb62-7" data-line-number="7"><span class="co">#&gt; [21] -3.22537541 -1.10068703  1.73498404  0.58726311  1.32815874</span></a>
<a class="sourceLine" id="cb62-8" data-line-number="8"><span class="co">#&gt; [26]  1.69590640 -1.29646063 -0.05494371 -0.14791185 -0.58604223</span></a>
<a class="sourceLine" id="cb62-9" data-line-number="9"><span class="co">#&gt; [31]  0.80251622 -0.19949876 -1.47620130 -0.68854648  0.26585680</span></a>
<a class="sourceLine" id="cb62-10" data-line-number="10"><span class="co">#&gt; [36]  0.04394481  0.94991171  0.07063645  0.61062211 -2.19973874</span></a>
<a class="sourceLine" id="cb62-11" data-line-number="11"><span class="co">#&gt; [41] -4.76963949 -0.32964194  1.48016524 -0.74878561 -0.35999349</span></a>
<a class="sourceLine" id="cb62-12" data-line-number="12"><span class="co">#&gt; [46]  0.26808232 -0.55363011  0.05715972  2.13901687  1.03593326</span></a>
<a class="sourceLine" id="cb62-13" data-line-number="13"><span class="co">#&gt; [51] -0.63324934  1.69777215  1.27213883 -1.56710339  1.53337324</span></a>
<a class="sourceLine" id="cb62-14" data-line-number="14"><span class="co">#&gt; [56] -0.67340422  1.28850329  1.13373721 -0.07612546  1.69624293</span></a>
<a class="sourceLine" id="cb62-15" data-line-number="15"><span class="co">#&gt; [61] -2.13737488  0.08742628 -1.27229607 -0.01182331  1.59204471</span></a>
<a class="sourceLine" id="cb62-16" data-line-number="16"><span class="co">#&gt; [66]  2.02312613  1.93588793  0.78383493 -0.53895044  0.14461297</span></a>
<a class="sourceLine" id="cb62-17" data-line-number="17"><span class="co">#&gt; [71]  3.49998665  1.97162461  1.40403152  1.96229410 -0.12139815</span></a>
<a class="sourceLine" id="cb62-18" data-line-number="18"><span class="co">#&gt; [76]  0.89586586 -1.20020568 -0.88919276 -0.01788428  0.84583360</span></a>
<a class="sourceLine" id="cb62-19" data-line-number="19"><span class="co">#&gt; [81] -3.16539955 -0.47796935 -0.64045554  0.80463821  1.03328919</span></a>
<a class="sourceLine" id="cb62-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb62-21" data-line-number="21"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb62-22" data-line-number="22"><span class="co">#&gt;  [1] -0.4527585506 -1.0172367096 -0.4506332278  0.8762004375  0.1175051630</span></a>
<a class="sourceLine" id="cb62-23" data-line-number="23"><span class="co">#&gt;  [6]  1.2471966743 -1.0354368687  2.4068284035  0.2288773656  1.3052561283</span></a>
<a class="sourceLine" id="cb62-24" data-line-number="24"><span class="co">#&gt; [11]  2.2329857349  0.8711666465 -2.7800273895  1.1981728077 -1.3957386017</span></a>
<a class="sourceLine" id="cb62-25" data-line-number="25"><span class="co">#&gt; [16] -1.1938062906 -0.9319203496 -0.7427287698 -0.3932662606 -1.1850622892</span></a>
<a class="sourceLine" id="cb62-26" data-line-number="26"><span class="co">#&gt; [21] -1.2337827682  0.0391844995  1.4692529440  0.9954308867 -0.5276314020</span></a>
<a class="sourceLine" id="cb62-27" data-line-number="27"><span class="co">#&gt; [26]  0.0052912235 -3.7251703739  0.7714666128  0.9288847446  1.0575201511</span></a>
<a class="sourceLine" id="cb62-28" data-line-number="28"><span class="co">#&gt; [31] -0.2037402093  1.3441133499 -0.6145500541 -1.9812527895 -0.3403103948</span></a>
<a class="sourceLine" id="cb62-29" data-line-number="29"><span class="co">#&gt; [36]  0.4891647100  0.2438151687 -0.6851536632 -0.2789261043  0.1960459650</span></a>
<a class="sourceLine" id="cb62-30" data-line-number="30"><span class="co">#&gt; [41]  2.3337526321 -0.2917928696  0.2283707857  1.4030313492  0.0939905122</span></a>
<a class="sourceLine" id="cb62-31" data-line-number="31"><span class="co">#&gt; [46]  1.1593261957 -0.5887037516 -0.3914591968  0.6122305393 -0.0005217344</span></a>
<a class="sourceLine" id="cb62-32" data-line-number="32"><span class="co">#&gt; [51] -0.2126427293 -0.1144591570  0.0500445664 -1.7837839127  0.2014352381</span></a>
<a class="sourceLine" id="cb62-33" data-line-number="33"><span class="co">#&gt; [56] -1.1722066402 -0.6031852961 -0.7491376400 -1.0345443487 -0.2920551002</span></a>
<a class="sourceLine" id="cb62-34" data-line-number="34"><span class="co">#&gt; [61]  0.7276004553  1.2423870564  2.2319626808  0.3553900719 -0.5595567822</span></a>
<a class="sourceLine" id="cb62-35" data-line-number="35"><span class="co">#&gt; [66]  1.1510205269  0.6762453318 -0.6442477703 -0.3994759917 -0.6871493459</span></a>
<a class="sourceLine" id="cb62-36" data-line-number="36"><span class="co">#&gt; [71]  0.7143861651 -0.2325166762 -0.2274321616  0.6617624760 -1.5715823174</span></a>
<a class="sourceLine" id="cb62-37" data-line-number="37"><span class="co">#&gt; [76] -1.0274018049  1.0900812149  0.7256541848  0.8817523718  1.0478113890</span></a>
<a class="sourceLine" id="cb62-38" data-line-number="38"><span class="co">#&gt; [81] -1.3642948866 -0.4680343866 -1.0020393133  0.6873189211  0.2874433696</span></a>
<a class="sourceLine" id="cb62-39" data-line-number="39"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb62-40" data-line-number="40"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb62-41" data-line-number="41"><span class="co">#&gt;  [1] -1.66799724 -0.31462803 -0.07048267  0.47869289  0.00525923</span></a>
<a class="sourceLine" id="cb62-42" data-line-number="42"><span class="co">#&gt;  [6]  1.27775264 -2.01790786  1.08377373  0.12464118 -0.26167497</span></a>
<a class="sourceLine" id="cb62-43" data-line-number="43"><span class="co">#&gt; [11]  1.12701774  0.30989689  2.02507019 -0.70055324 -0.61895663</span></a>
<a class="sourceLine" id="cb62-44" data-line-number="44"><span class="co">#&gt; [16]  1.26067650  0.13994022  0.67642587 -2.05223727  0.52698410</span></a>
<a class="sourceLine" id="cb62-45" data-line-number="45"><span class="co">#&gt; [21] -3.13812375 -0.34984887  0.15795122  0.16967219  1.14865243</span></a>
<a class="sourceLine" id="cb62-46" data-line-number="46"><span class="co">#&gt; [26] -0.04162211  1.35208511  0.65789407 -0.19445431 -0.75118661</span></a>
<a class="sourceLine" id="cb62-47" data-line-number="47"><span class="co">#&gt; [31] -0.75471002 -0.23062927  1.05399203 -0.40653789  0.34343180</span></a>
<a class="sourceLine" id="cb62-48" data-line-number="48"><span class="co">#&gt; [36] -0.31112960 -1.27419460  0.93029964  0.02720148 -1.22925198</span></a>
<a class="sourceLine" id="cb62-49" data-line-number="49"><span class="co">#&gt; [41] -0.98689252 -0.03388155  0.13261238  1.21204257 -0.58923507</span></a>
<a class="sourceLine" id="cb62-50" data-line-number="50"><span class="co">#&gt; [46]  1.41246438 -1.00878584 -1.31356204  0.07231057 -1.50667369</span></a>
<a class="sourceLine" id="cb62-51" data-line-number="51"><span class="co">#&gt; [51] -1.14036369 -1.27124703 -1.30463350  1.13268960  1.08635914</span></a>
<a class="sourceLine" id="cb62-52" data-line-number="52"><span class="co">#&gt; [56]  0.05002058 -0.83821458 -0.86786515 -0.61552852 -0.18724760</span></a>
<a class="sourceLine" id="cb62-53" data-line-number="53"><span class="co">#&gt; [61] -0.11673179 -0.44532412 -0.12393313  1.63498080  1.39351642</span></a>
<a class="sourceLine" id="cb62-54" data-line-number="54"><span class="co">#&gt; [66]  1.03854430 -0.37857199 -0.27956575 -1.32880223 -1.82409549</span></a>
<a class="sourceLine" id="cb62-55" data-line-number="55"><span class="co">#&gt; [71]  0.39723620  0.51845258 -0.25960159  0.80245513  1.39410090</span></a>
<a class="sourceLine" id="cb62-56" data-line-number="56"><span class="co">#&gt; [76] -1.57615566  1.20807958  0.50640631  0.05387082  0.43062329</span></a>
<a class="sourceLine" id="cb62-57" data-line-number="57"><span class="co">#&gt; [81]  2.29930806  1.91082525  1.52598381 -0.72471607  0.01756289</span></a></code></pre></div>
</div>
<div id="multi-dimensional-scaling" class="section level4">
<h4>4.2.1 Multi Dimensional Scaling</h4>
<p>The mds() function is to apply multi-dimensional scaling on input data, with output of a K-dimensional array data. K should be an input parameter for mds() function.</p>
<p>For example, to apply mds() on the 6 selected variables, and scaling down to a 2-d space:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">mds_v &lt;-<span class="st"> </span><span class="kw">mds</span>(std_data, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2">mds_v</a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb63-4" data-line-number="4"><span class="co">#&gt;  [1] -2.15079914  1.24630268 -2.07714878  0.60372394  0.96266208</span></a>
<a class="sourceLine" id="cb63-5" data-line-number="5"><span class="co">#&gt;  [6] -2.02217510  0.83754212 -2.31564183  1.71969219 -0.99525060</span></a>
<a class="sourceLine" id="cb63-6" data-line-number="6"><span class="co">#&gt; [11] -1.30435076  1.50636158  1.09196128 -1.42777743 -1.00126761</span></a>
<a class="sourceLine" id="cb63-7" data-line-number="7"><span class="co">#&gt; [16]  0.34988392 -1.24823585 -1.98039435  0.87822863 -2.18980981</span></a>
<a class="sourceLine" id="cb63-8" data-line-number="8"><span class="co">#&gt; [21] -3.22537671 -1.10068748  1.73498453  0.58726327  1.32815937</span></a>
<a class="sourceLine" id="cb63-9" data-line-number="9"><span class="co">#&gt; [26]  1.69590647 -1.29646036 -0.05494364 -0.14791185 -0.58604238</span></a>
<a class="sourceLine" id="cb63-10" data-line-number="10"><span class="co">#&gt; [31]  0.80251602 -0.19949879 -1.47620137 -0.68854692  0.26585690</span></a>
<a class="sourceLine" id="cb63-11" data-line-number="11"><span class="co">#&gt; [36]  0.04394477  0.94991127  0.07063695  0.61062210 -2.19973976</span></a>
<a class="sourceLine" id="cb63-12" data-line-number="12"><span class="co">#&gt; [41] -4.76964008 -0.32964200  1.48016556 -0.74878501 -0.35999381</span></a>
<a class="sourceLine" id="cb63-13" data-line-number="13"><span class="co">#&gt; [46]  0.26808279 -0.55363073  0.05715920  2.13901710  1.03593266</span></a>
<a class="sourceLine" id="cb63-14" data-line-number="14"><span class="co">#&gt; [51] -0.63325014  1.69777170  1.27213835 -1.56710325  1.53337397</span></a>
<a class="sourceLine" id="cb63-15" data-line-number="15"><span class="co">#&gt; [56] -0.67340435  1.28850297  1.13373674 -0.07612582  1.69624307</span></a>
<a class="sourceLine" id="cb63-16" data-line-number="16"><span class="co">#&gt; [61] -2.13737510  0.08742638 -1.27229550 -0.01182236  1.59204555</span></a>
<a class="sourceLine" id="cb63-17" data-line-number="17"><span class="co">#&gt; [66]  2.02312714  1.93588814  0.78383508 -0.53895129  0.14461212</span></a>
<a class="sourceLine" id="cb63-18" data-line-number="18"><span class="co">#&gt; [71]  3.49998720  1.97162518  1.40403139  1.96229461 -0.12139763</span></a>
<a class="sourceLine" id="cb63-19" data-line-number="19"><span class="co">#&gt; [76]  0.89586507 -1.20020531 -0.88919260 -0.01788424  0.84583380</span></a>
<a class="sourceLine" id="cb63-20" data-line-number="20"><span class="co">#&gt; [81] -3.16539934 -0.47796907 -0.64045496  0.80463804  1.03328917</span></a>
<a class="sourceLine" id="cb63-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb63-22" data-line-number="22"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb63-23" data-line-number="23"><span class="co">#&gt;  [1]  0.4527536271  1.0172360777  0.4506333060 -0.8761993256 -0.1175050604</span></a>
<a class="sourceLine" id="cb63-24" data-line-number="24"><span class="co">#&gt;  [6] -1.2471938904  1.0354317522 -2.4068255542 -0.2288768376 -1.3052569054</span></a>
<a class="sourceLine" id="cb63-25" data-line-number="25"><span class="co">#&gt; [11] -2.2329825675 -0.8711658576  2.7800335222 -1.1981746825  1.3957368458</span></a>
<a class="sourceLine" id="cb63-26" data-line-number="26"><span class="co">#&gt; [16]  1.1938096673  0.9319203178  0.7427303650  0.3932609148  1.1850635503</span></a>
<a class="sourceLine" id="cb63-27" data-line-number="27"><span class="co">#&gt; [21]  1.2337742453 -0.0391857512 -1.4692520664 -0.9954304939  0.5276346328</span></a>
<a class="sourceLine" id="cb63-28" data-line-number="28"><span class="co">#&gt; [26] -0.0052911254  3.7251741858 -0.7714651225 -0.9288852134 -1.0575222027</span></a>
<a class="sourceLine" id="cb63-29" data-line-number="29"><span class="co">#&gt; [31]  0.2037382670 -1.3441142042  0.6145525650  1.9812515041  0.3403112204</span></a>
<a class="sourceLine" id="cb63-30" data-line-number="30"><span class="co">#&gt; [36] -0.4891656117 -0.2438184179  0.6851562571  0.2789261438 -0.1960495395</span></a>
<a class="sourceLine" id="cb63-31" data-line-number="31"><span class="co">#&gt; [41] -2.3337555238  0.2917926603 -0.2283703585 -1.4030283522 -0.0939921633</span></a>
<a class="sourceLine" id="cb63-32" data-line-number="32"><span class="co">#&gt; [46] -1.1593228571  0.5887008391  0.3914559889 -0.6122301079  0.0005178202</span></a>
<a class="sourceLine" id="cb63-33" data-line-number="33"><span class="co">#&gt; [51]  0.2126394543  0.1144559991 -0.0500478842  1.7837865496 -0.2014320665</span></a>
<a class="sourceLine" id="cb63-34" data-line-number="34"><span class="co">#&gt; [56]  1.1722066773  0.6031832609  0.7491354510  1.0345427824  0.2920548746</span></a>
<a class="sourceLine" id="cb63-35" data-line-number="35"><span class="co">#&gt; [61] -0.7276009862 -1.2423880289 -2.2319623928 -0.3553856899  0.5595608248</span></a>
<a class="sourceLine" id="cb63-36" data-line-number="36"><span class="co">#&gt; [66] -1.1510175196 -0.6762460298  0.6442473714  0.3994723166  0.6871446314</span></a>
<a class="sourceLine" id="cb63-37" data-line-number="37"><span class="co">#&gt; [71] -0.7143845504  0.2325183231  0.2274315570 -0.6617601262  1.5715860386</span></a>
<a class="sourceLine" id="cb63-38" data-line-number="38"><span class="co">#&gt; [76]  1.0273976841 -1.0900782001 -0.7256530463 -0.8817525785 -1.0478103198</span></a>
<a class="sourceLine" id="cb63-39" data-line-number="39"><span class="co">#&gt; [81]  1.3643006281  0.4680391875  1.0020432867 -0.6873206957 -0.2874432665</span></a></code></pre></div>
</div>
</div>
<div id="spatial-clustering" class="section level3">
<h3>4.3 Spatial Clustering</h3>
<p>Spatial clustering aims to group of a large number of geographic areas or points into a smaller number of regions based on similiarities in one or more variables. Spatially constrained clustering is needed when clusters are required to be spatially contiguous.</p>
<p>In GeoDa, there are three different approaches explicitly incorporate the contiguity constraint in the optimization process: SKATER, Redcap and Max-p. More more details, please check: <a href="http://geodacenter.github.io/workbook/8_spatial_clusters/lab8.html" class="uri">http://geodacenter.github.io/workbook/8_spatial_clusters/lab8.html</a> All of these methods are included in rgeoda 0.0.4.</p>
<p>For example, to apply spatial clustering on the Guerry dataset, we use the queen weights to define the spatial contiguity and select 6 variables for similarity measure: “Crm_prs”, “Crm_prp”, “Litercy”, “Donatns”, “Infants”, “Suicids”.</p>
<p>The following code is used to get a 2D data vector for the selected variables:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">data &lt;-<span class="st"> </span><span class="kw">as.list</span>(guerry_df[<span class="kw">c</span>(<span class="st">'Crm_prs'</span>,<span class="st">'Crm_prp'</span>,<span class="st">'Litercy'</span>,<span class="st">'Donatns'</span>,<span class="st">'Infants'</span>,<span class="st">'Suicids'</span>)])</a></code></pre></div>
<div id="skater" class="section level4">
<h4>4.3.1 SKATER</h4>
<p>The Spatial C(K)luster Analysis by Tree Edge Removal(SKATER) algorithm introduced by Assuncao et al. (2006) is based on the optimal pruning of a minimum spanning tree that reflects the contiguity structure among the observations. It provides an optimized algorithm to prune to tree into several clusters that their values of selected variables are as similar as possible.</p>
<p>The rgeoda’s SKATER function is:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">skater</span>(k, w, data, <span class="dt">distance_method=</span><span class="st">'euclidean'</span>, <span class="dt">bound_vals =</span> [],  <span class="dt">min_bound =</span> <span class="dv">0</span>, <span class="dt">random_seed=</span><span class="dv">123456789</span>)</a></code></pre></div>
<p>For example, to create 4 spatially contiguous clusters using Guerry dataset, the queen weights and the values of the 6 selected variables:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">guerry_clusters &lt;-<span class="st"> </span><span class="kw">skater</span>(<span class="dv">4</span>, queen_w, data)</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">guerry_clusters</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="co">#&gt;  [1] 15 74 16 55 60 39 68 33 17 82 81  0  2 40 20 80</span></a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb66-7" data-line-number="7"><span class="co">#&gt;  [1] 46 50 34 38 69 47 58 19 32 41 53 26</span></a>
<a class="sourceLine" id="cb66-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb66-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb66-10" data-line-number="10"><span class="co">#&gt;  [1] 49 52 72 84  8 57 56 59 42  1 25 51 48 54 64 75 18 83 73 36 24 71  6</span></a>
<a class="sourceLine" id="cb66-11" data-line-number="11"><span class="co">#&gt; [24] 67 65 70 22 12</span></a>
<a class="sourceLine" id="cb66-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb66-13" data-line-number="13"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb66-14" data-line-number="14"><span class="co">#&gt;  [1] 23 79  3 29 61 21 44 11 28 13 30 35 76 77 43  9 27 45 31 78  4 10 66</span></a>
<a class="sourceLine" id="cb66-15" data-line-number="15"><span class="co">#&gt; [24] 37  5 14  7 63 62</span></a></code></pre></div>
<p>This <code>skater()</code> function returns a 2D list, which represents 4 clusters. Each cluster is composed by several contiguity areas, e.g. 15, 74, 16, 55, 60, 39, 68, 33, 17, 82, 81, 0, 2, 40, 20, 80</p>
<p>rgeoda also provides utility functions to compute some descriptive statistics of the clustering results, e.g. to compute the ratio of between to total sum of squares:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(guerry_clusters, data)</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">totalss &lt;-<span class="st"> </span><span class="kw">total_sumofsquare</span>( data)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">ratio &lt;-<span class="st">  </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="kw">cat</span>(<span class="st">&quot;The ratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="co">#&gt; The ratio of between to total sum of square: 0.3156447</span></a></code></pre></div>
</div>
<div id="redcap" class="section level4">
<h4>4.3.2 REDCAP</h4>
<p>REDCAP (Regionalization with dynamically constrained agglomerative clustering and partitioning) is developed by D. Guo (2008). Like SKATER, REDCAP starts from building a spanning tree with 3 different ways (single-linkage, average-linkage, and the complete-linkage). The single-linkage way leads to build a minimum spanning tree. Then,REDCAP provides 2 different ways (first‐order and full-order constraining) to prune the tree to find clusters. The first-order approach with a minimum spanning tree is exactly the same with SKATER. In GeoDa and rgeoda, the following methods are provided:</p>
<ul>
<li>First-order and Single-linkage</li>
<li>Full-order and Complete-linkage</li>
<li>Full-order and Average-linkage</li>
<li>Full-order and Single-linkage</li>
</ul>
<p>For example, to find 4 clusters using the same dataset and weights as above using REDCAP with Full-order and Complete-linkage method:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">redcap_clusters &lt;-<span class="st"> </span><span class="kw">redcap</span>(<span class="dv">4</span>, queen_w, data, <span class="st">&quot;fullorder-completelinkage&quot;</span>)</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">redcap_clusters</a>
<a class="sourceLine" id="cb68-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb68-4" data-line-number="4"><span class="co">#&gt;  [1] 15 74 16 55 60 39 68 33 17 82 81  0  2 40 20 80</span></a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb68-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb68-7" data-line-number="7"><span class="co">#&gt;  [1] 46 50 34 38 69 47 58 19 32 41 53 26</span></a>
<a class="sourceLine" id="cb68-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb68-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb68-10" data-line-number="10"><span class="co">#&gt;  [1] 49 52 72 84  8 57 56 59 42  1 25 51 48 54 64 75 18 83 73 36 24 71  6</span></a>
<a class="sourceLine" id="cb68-11" data-line-number="11"><span class="co">#&gt; [24] 67 65 70 22 12</span></a>
<a class="sourceLine" id="cb68-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb68-13" data-line-number="13"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb68-14" data-line-number="14"><span class="co">#&gt;  [1] 23 79  3 29 61 21 44 11 28 13 30 35 76 77 43  9 27 45 31 78  4 10 66</span></a>
<a class="sourceLine" id="cb68-15" data-line-number="15"><span class="co">#&gt; [24] 37  5 14  7 63 62</span></a>
<a class="sourceLine" id="cb68-16" data-line-number="16"></a>
<a class="sourceLine" id="cb68-17" data-line-number="17">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(redcap_clusters, data)</a>
<a class="sourceLine" id="cb68-18" data-line-number="18">totalss &lt;-<span class="st"> </span><span class="kw">total_sumofsquare</span>( data)</a>
<a class="sourceLine" id="cb68-19" data-line-number="19">ratio &lt;-<span class="st"> </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb68-20" data-line-number="20"><span class="kw">cat</span>(<span class="st">&quot;The ratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb68-21" data-line-number="21"><span class="co">#&gt; The ratio of between to total sum of square: 0.3156447</span></a></code></pre></div>
</div>
<div id="max-p" class="section level4">
<h4>4.3.3 Max-p</h4>
<p>The so-called max-p regions model (outlined in Duque, Anselin, and Rey 2012) uses a different approach and considers the regionalization problem as an application of integer programming. In addition, the number of regions is determined endogenously.</p>
<p>The algorithm itself consists of a search process that starts with an initial feasible solution and iteratively improves upon it while maintaining contiguity among the elements of each cluster. Like Geoda, rgeoda provides three different heuristic algorithms to find an optimal solution for max-p:</p>
<ul>
<li>greedy</li>
<li>Tabu Search</li>
<li>Simulated Annealing</li>
</ul>
<p>Unlike SKATER and REDCAP that one can specify the number of clusters as an input paramter, max-p doesn’t allow to specify the number of clusters explicitly, but a constrained variable and the minimum bounding value that each cluster should reach that are used to find an optimized number of clusters.</p>
<p>For example, to use <code>greedy</code> algorithm in maxp function with the same dataset and weights as above to find optimal clusters using max-p:</p>
<p>First, we need to specify, for example, every cluster must have population &gt;= 3236.67 thousands people:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">bound_vals &lt;-<span class="st"> </span>guerry_df[<span class="st">'Pop1831'</span>][,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">min_bound &lt;-<span class="st"> </span><span class="fl">3236.67</span> <span class="co"># 10% of Pop1831</span></a></code></pre></div>
<p>Then, we can call the max-p function with “greedy” algorith, the bound values and minimum bound value:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">maxp_clusters &lt;-<span class="st"> </span><span class="kw">maxp</span>(queen_w, data, bound_vals, min_bound, <span class="st">&quot;greedy&quot;</span>)</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"></a>
<a class="sourceLine" id="cb70-3" data-line-number="3">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(maxp_clusters, data)</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">ratio &lt;-<span class="st"> </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb70-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;The ratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="co">#&gt; The ratio of between to total sum of square: 0.5035491</span></a></code></pre></div>
<p>We can also specify using <code>tabu search</code> algorithm in maxp function with the parameter of tabu length:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">maxp_tabu_clusters &lt;-<span class="st"> </span><span class="kw">maxp</span>(queen_w, data, bound_vals, min_bound, <span class="st">&quot;tabu&quot;</span>, <span class="dt">tabu_length=</span><span class="dv">95</span>)</a>
<a class="sourceLine" id="cb71-2" data-line-number="2"></a>
<a class="sourceLine" id="cb71-3" data-line-number="3">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(maxp_tabu_clusters, data)</a>
<a class="sourceLine" id="cb71-4" data-line-number="4">ratio &lt;-<span class="st"> </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;The ratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb71-6" data-line-number="6"><span class="co">#&gt; The ratio of between to total sum of square: 0.5260249</span></a></code></pre></div>
<p>To apply <code>simulated annealing</code> algorithm in maxp function with the parameter of cooling rate:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">maxp_sa_clusters &lt;-<span class="st"> </span><span class="kw">maxp</span>(queen_w, data, bound_vals, min_bound, <span class="st">&quot;sa&quot;</span>, <span class="dt">cool_rate=</span><span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb72-2" data-line-number="2"></a>
<a class="sourceLine" id="cb72-3" data-line-number="3">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(maxp_sa_clusters, data)</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">ratio &lt;-<span class="st"> </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb72-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;The ratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb72-6" data-line-number="6"><span class="co">#&gt; The ratio of between to total sum of square: 0.5260249</span></a></code></pre></div>
<p>We can also increase the number of iterations for local search process by specifying the parameter <code>initial</code> (default value is 99):</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">maxp_clusters &lt;-<span class="st"> </span><span class="kw">maxp</span>(queen_w, data, bound_vals, min_bound, <span class="st">&quot;greedy&quot;</span>, <span class="dt">initial=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"></a>
<a class="sourceLine" id="cb73-3" data-line-number="3">betweenss &lt;-<span class="st"> </span><span class="kw">between_sumofsquare</span>(maxp_clusters, data)</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">ratio &lt;-<span class="st"> </span>betweenss <span class="op">/</span><span class="st"> </span>totalss</a>
<a class="sourceLine" id="cb73-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;Tratio of between to total sum of square:&quot;</span>, ratio)</a>
<a class="sourceLine" id="cb73-6" data-line-number="6"><span class="co">#&gt; Tratio of between to total sum of square: 0.5260249</span></a></code></pre></div>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
